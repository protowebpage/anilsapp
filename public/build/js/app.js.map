{"version":3,"sources":["app.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["if(Dropzone != undefined){\n\tDropzone.autoDiscover = false;\n}\n\n\n$(function(){\n\t\n\tvar app = new App($('#app'));\n\n\t$('#modal-log-in').find('form').on('submit', function(e){\n\t\te.preventDefault();\n\t\tvar form = $(this);\n\t\t$.ajax({\n\t\t\ttype: 'post',\n\t\t\turl: '/customer/login',\n\t\t\tdata: form.serialize(),\n\t\t\tbeforeSend: function(){},\n\t\t\terror: function(response){\n\t\t\t\tapp.displayFormErrors(form, response.responseJSON);\n\t\t\t},\n\t\t\tsuccess: function(response){\n\t\t\t\tif (response.result == 'success') {\n\t\t\t\t\t$('#modal-log-in').modal('hide');\n\t\t\t\t\tapp.updateProfileLinks();\n\t\t\t\t\tapp.initAddressForm();\n\t\t\t\t} else {\n\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t})\n\n\n});\n\nApp.prototype.updateProfileLinks = function(){\n\t$.ajax({\n\t\turl: '/my/credentials',\n\t\tsuccess:function(response){\n\t\t\t$('header, footer').find('.profile-link').replaceWith(response);\n\t\t\t// $('#customer-credentials').html($(response.headerCredentials));\n\t\t\t// $('footer').find('a[data-toggle=\"modal\"]').replaceWith(response.footerCredentials)\n\t\t}\n\t})\n}\n\n\nfunction App(container){\n\tvar self = this;\n\n\tthis.appContainer = container;\n\tthis.dropZone = null;\n\tthis.filename = null;\n\tthis.formComment = null;\n\tself.formAddress = null;\n\tself.formSubproductProperties = null;\n\n\tthis.productRowCounter = 0;\n\tthis.productColCounter = 1;\n\tthis.productItemsInRow = 4;\n\tthis.productWidthBase = 120;\n\tthis.productHeightBase = 140;\n\tthis.productTopOffset = 65;\n\n\tthis.subproductsInitiated = false;\n\tthis.subproductRowCounter = 0;\n\tthis.subProductColCounter = 1;\n\tthis.subproductItemsInRow = 3;\n\tthis.subproductWidthBase = 140;\n\tthis.subproductHeightBase = 140;\n\tthis.subproductTopOffset = 180;\n\n\tthis.subproductPropertiesInitiated = false;\n\n\tthis.blockLayer = $('#blocked');\n\n\tthis.initProducts();\n\tthis.initDropzone();\n\n\tthis.initAddressForm();\n}\n\n\nApp.prototype.initProducts = function(){\n\n\tvar self = this;\n\n\tself.blockUserInteractions(1000);\n\n\t$('.product').each(function(i){\n\n\t\t$(this).css({\n\t\t\tleft: self.productWidthBase * self.productColCounter,\n\t\t\ttop: self.productTopOffset + self.productHeightBase * self.productRowCounter\n\t\t});\n\n\t\tself.productColCounter++;\n\t\tif (self.productColCounter > self.productItemsInRow) {\n\t\t\tself.productColCounter\t= 1;\t\n\t\t\tself.productRowCounter++;\n\t\t}\n\n\t})\n\n\t$('.product').on('click.selectProduct', selectProduct);\n\n\tfunction selectProduct(e){\n\t\te.preventDefault();\n\t\tself.blockUserInteractions(1700);\n\n\t\tvar product = $(this);\n\n\t\t$.post('/order/collect', { \n\t\t\tproduct: product.attr('data-id')\n\t\t})\t\n\t\t\t.fail(function(response){\n\t\t\t\tself.displayAjaxResponseError(response);\n\t\t\t})\n\t\t\t.done(function(response){\n\n\t\t\t\t$('.product').not(product).removeClass('visible');\n\t\t\t\tself.getSubProducts(product.attr('data-id'));\n\n\t\t\t\tproduct.addClass('selected')\n\t\t\t\t\t.off('click.selectProduct')\n\t\t\t\t\t.on('click.unselectProduct', unselectProduct);\n\t\t\t\t\n\t\t\t\tself.screenUp();\n\t\t\t\t\n\t\t\t\tsetTimeout(function(){\n\t\t\t\t\tself.screenUp();\n\t\t\t\t}, 600);\n\n\t\t\t});\n\t}\n\n\tfunction unselectProduct(e){\n\t\te.preventDefault();\n\t\tself.blockUserInteractions(1000);\n\n\t\t$('.product').addClass('visible');\n\t\t$(this).removeClass('selected')\n\t\t\t.on('click.selectProduct', selectProduct);\n\n\t\tif(self.dropZone != null && self.filename != null) {\n\t\t\tself.dropZone.removeAllFiles(true);\n\t\t}\n\n\t\t$('.subproduct').removeClass('selected').removeClass('visible');\n\t\tself.screenTo(1);\n\t}\n}\n\n\nApp.prototype.initSubproducts = function(){\n\n\tvar self = this;\n\n\tif(this.subproductsInitiated) return;\n\tthis.subproductsInitiated = true; \n\n\t\n\t\t$('.subproduct').each(function(i){\n\n\t\t\t$(this).css({\n\t\t\t\tleft: self.subproductWidthBase * self.subProductColCounter,\n\t\t\t\ttop: self.subproductTopOffset + self.subproductHeightBase * self.subproductRowCounter\n\t\t\t});\n\n\t\t\tself.subProductColCounter++;\n\t\t\tif (self.subProductColCounter > self.subproductItemsInRow) {\n\t\t\t\tself.subProductColCounter\t= 1;\t\n\t\t\t\tself.subproductRowCounter++;\n\t\t\t}\n\n\t\t});\n\n\t$('.subproduct').on('click.selectSubProduct', selectSubProduct);\n\n\tfunction selectSubProduct(e){\n\t\te.preventDefault();\n\n\t\tself.blockUserInteractions(1500);\n\n\t\tvar subProduct = $(this);\n\t\tsubProduct.off('click.selectSubProduct');\n\n\t\t$.ajax({\n\t\t\ttype: 'post',\n\t\t\turl: '/order/collect',\n\t\t\tdata: {\n\t\t\t\t'variation_id' : subProduct.attr('data-id')\n\t\t\t},\n\t\t\terror: function(response){\n\t\t\t\tsubProduct.on('click.selectSubProduct');\n\t\t\t\tself.displayAjaxResponseError(response);\n\t\t\t},\n\t\t\tsuccess: function(response){\n\n\t\t\t\t$('.subproduct').not(subProduct).removeClass('visible');\n\t\t\t\t\n\t\t\t\tsubProduct.addClass('selected')\n\t\t\t\t\t.on('click.unselectSubProduct', unSelectSubProduct);\n\n\t\t\t\tself.screenUp();\n\t\t\t\tself.initSubproductProperties();\n\n\t\t\t\tsetTimeout(function(){\n\t\t\t\t\tself.screenUp();\n\t\t\t\t}, 600);\n\t\t\t}\n\t\t})\n\n\n\t}\n\n\tfunction unSelectSubProduct(e){\n\t\te.preventDefault();\n\n\t\tself.blockUserInteractions(1000);\n\n\t\t$(this).off('.click.unselectSubProduct')\n\t\t\t.removeClass('selected')\n\t\t\t.on('click.selectSubProduct', selectSubProduct);\n\n\t\t$('.subproduct').addClass('visible');\n\n\t\tself.screenTo(6);\n\t}\n}\n\n\nApp.prototype.initSubproductProperties = function(){\n\tvar self = this;\n\n\tif(this.subproductPropertiesInitiated === true) return;\n\t\n\tself.formSubproductProperties = $('.subproduct-properties');\n\tself.subproductPropertiesInitiated = true;\n\n\tself.formSubproductProperties.on('submit', function(e){\n\t\te.preventDefault();\n\n\t\t$.ajax({\n\t\t\ttype: 'post',\n\t\t\turl: '/order/collect',\n\t\t\tdata: $(this).serialize(),\n\t\t\tbeforeSend: function(){\n\t\t\t\tself.blockUserInteractions();\n\t\t\t},\n\t\t\terror: function(response){\n\t\t\t\tself.displayFormErrors(self.formSubproductProperties, response.responseJSON);\n\t\t\t\tself.unblockUserInteractions();\n\t\t\t\t// self.displayAjaxResponseError(response);\n\t\t\t},\n\t\t\tsuccess: function(response){\n\t\t\t\tself.blockUserInteractions(1100);\n\t\t\t\tself.screenUp();\n\t\t\t}\n\t\t})\n\n\t})\n}\n\n\nApp.prototype.getSubProducts = function(productId){\n\tvar self = this;\n\n\t$.ajax({\n\t\turl: '/product/'+productId+'/variations',\n\t\terror: function(response){\n\t\t},\n\t\tsuccess: function(response){\n\t\t\t$('.subproducts').html(response);\n\n\t\t\tself.subproductsInitiated = null;\n\t\t\tself.subproductRowCounter = 0;\n\t\t\tself.subProductColCounter = 1;\n\n\t\t}\n\t})\n}\n\n\n\nApp.prototype.initCommentForm = function(){\n\tvar self = this;\n\n\tif(!self.formComment) {\n\n\t\tself.formComment = $('.form-comment');\n\n\t\tself.formComment.on('submit', function(e){\n\t\t\te.preventDefault();\n\n\t\t\tself.blockUserInteractions(1100);\n\t\t\tself.screenUp();\n\n\t\t\t$('.subproduct').addClass('visible');\n\n\t\t\t$.post('/order/collect', {\n\t\t\t\tcomment: $(this).find('textarea').val()\n\t\t\t});\n\n\t\t\tself.initSubproducts();\n\t\t})\n\n\t}\n}\n\n\nApp.prototype.initAddressForm = function(){\n\n\tvar self = this;\n\n\t$.ajax({\n\t\turl: '/order/credentials',\n\t\tsuccess: function(response){\n\n\t\t\tself.formAddress = $(response);\n\t\t\t$('.delivered-to-container').html(self.formAddress);\n\n\t\t\tself.formAddress.on('submit', function(e){\n\t\t\t\te.preventDefault();\n\t\t\t\tself.blockUserInteractions();\n\n\t\t\t\tvar button = $('button[type=\"submit\"]', self.formAddress);\n\t\t\t\t\n\n\n\t\t\t\t$.ajax({\n\t\t\t\t\ttype: 'post',\n\t\t\t\t\turl: '/order/collect' ,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taddress1: self.formAddress.find('input[name=\"address1\"]').val()\n\t\t\t\t\t},\n\t\t\t\t\tbeforeSend: function(){\n\t\t\t\t\t\tbutton.attr({disabled: 'disabled'});\n\t\t\t\t\t},\n\t\t\t\t\terror: function(response){\n\t\t\t\t\t\tself.unblockUserInteractions();\n\t\t\t\t\t\tself.displayFormErrors(self.formAddress, response.responseJSON);\n\t\t\t\t\t\t// self.displayAjaxResponseError(response);\n\t\t\t\t\t\tbutton.removeAttr('disabled');\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: function(response){\n\t\t\t\t\t\tself.blockUserInteractions(1500);\n\t\t\t\t\t\tbutton.removeAttr('disabled');\n\n\t\t\t\t\t\tself.saveOrder();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t})\n\n\n\t\t}\n\t})\n\n}\n\n\nApp.prototype.saveOrder = function(){\n\tvar self = this;\n\n\t$.ajax({\n\t\ttype: 'post',\n\t\turl: '/order',\n\t\tdata: this.formAddress.serialize(),\n\t\tbeforeSend: function(){\n\t\t\tself.blockUserInteractions();\n\t\t\tself.formAddress.find('button').attr({disabled: 'disabled'});\n\t\t},\n\t\terror: function(response){\n\t\t\tself.displayFormErrors(self.formAddress, response.responseJSON);\n\t\t\t// self.displayAjaxResponseError(response);\n\t\t\tself.formAddress.find('button').removeAttr('disabled');\n\t\t\tself.unblockUserInteractions();\n\t\t},\n\t\tsuccess: function(response){\n\t\t\tself.formAddress.find('button').removeAttr('disabled');\n\t\t\tself.unblockUserInteractions();\n\t\t\twindow.location = '/my/orders/checkout/'+response.orderId;\n\t\t}\n\t})\n}\n\nApp.prototype.initDropzone = function(){\n\tvar self = this;\n\n\tvar x = $('#design-upload').dropzone({\n\t\turl: '/file/temporary/customer-design',\n\t\tmaxFilesize: 5, // MB\n\t\theaders: {\n\t    'X-CSRF-Token': $('meta[name=\"csrf_token\"]').attr('content')\n\t  },\n\t  init: function(){\n\t  },\n\t  error: function(file, response) {\n\t  },\n\t  success: function(file, response) {\n\t  \tself.dropzoneSuccess(response.filenameOriginal);\n\t  }\n\t});\n\n\t$('.file').on('click', function(e){\n\t\te.preventDefault();\n\t\t\n\t\tself.blockUserInteractions(1100);\n\t\tself.screenTo(3);\n\n\t\t$('.subproduct').removeClass('selected').removeClass('visible');\n\t\tif(self.dropZone && self.filename){\n\t\t\tself.dropZone.removeAllFiles();\n\t\t}\n\t})\n\n\tthis.dropZone = x[0].dropzone;\n}\n\n\nApp.prototype.dropzoneSuccess = function(filename){\n\n\tvar self = this;\n\n\tself.blockUserInteractions(1500);\n\n\tthis.filename = filename;\n\t$('.filename').text(filename);\n\tthis.screenUp();\n\t\n\t$('button[type=\"reset\"]').on('click', function(e){\n\t\tself.blockUserInteractions(1400);\n\t\tself.screenTo(3);\n\t\tself.dropZone.removeAllFiles();\n\t})\n\n\tsetTimeout(function(){\n\t\tself.screenUp();\n\t\tself.initCommentForm();\n\t}, 600);\n}\n\n\nApp.prototype.displayAjaxResponseError = function(response){\n\t$.each(response.responseJSON, function(index, value){\n\t\t$.each(value, function(index, value){\n\t\t\ttoastr.error(value);\n\t\t});\n\t});\n}\n\n\nApp.prototype.screenUp = function(){\n\tvar screen = this.getCurrentScreen();\n\tthis.appContainer.removeClassWild('screen*').addClass('screen'+(screen.screenNumber+1));\n}\n\n\nApp.prototype.screenDown = function(){\n\tvar screen = this.getCurrentScreen();\n\tthis.appContainer.removeClassWild('screen*').addClass('screen'+(screen.screenNumber-1));\n\tthis.screenAdditionalActions(screen.screenNumber);\n}\n\n\nApp.prototype.screenTo = function(value){\n\tvar screen = this.getCurrentScreen();\n\tthis.appContainer.removeClassWild('screen*').addClass('screen'+value);\n\tthis.screenAdditionalActions(value);\n}\n\n\nApp.prototype.getCurrentScreen = function(){\n\tvar matches = this.appContainer.attr('class').match(/screen(\\d)/i);\n\treturn {\n\t\tcurrentClass: matches[0],\n\t\tscreenNumber: parseInt(matches[1])\n\t}\n}\n\n\nApp.prototype.screenAdditionalActions = function(screen){\n\tif(screen < 5){\n\t\tthis.clearForm(this.formComment);\n\t}\n\tif (screen < 8){\n\t\tthis.clearForm(this.formSubproductProperties);\n\t}\n\tif (screen < 9){\n\t\tthis.clearForm(this.formAddress);\n\t}\n}\n\n\nApp.prototype.blockUserInteractions = function(duration){\n\tvar self = this;\n\n\tduration = duration || false;\n\n\tthis.blockLayer.show();\n\n\tif(duration){\n\t\tsetTimeout(function(){\n\n\t\t\tself.blockLayer.hide();\n\n\t\t}, duration);\n\t}\n\n}\n\nApp.prototype.unblockUserInteractions = function(){\n\tthis.blockLayer.hide();\n}\n\n\nApp.prototype.displayFormErrors = function(form, errors){\n\tvar self = this;\n\n\tthis.clearFormErrors(form);\n\n\tfor(var fieldError in errors){\n\t\tvar field = form.find('*[name=\"'+fieldError+'\"]');\n\n\t\tfield\n\t\t\t.parents('.form-group')\n\t\t\t\t.addClass('has-error')\n\t\t\t\t.find('.help-block>strong').text(errors[fieldError]);\n\t}\n}\n\nApp.prototype.clearForm = function(form){\n\tif(!form || !form.length) return;\n\tform[0].reset();\n\tthis.clearFormErrors();\n}\n\nApp.prototype.clearFormErrors = function(form){\n\t$('.form-group', form).removeClass('has-error').find('.help-block>strong').text('');\t\n}\n\n\n\n$.fn.removeClassWild = function(mask) {\n\treturn this.removeClass(function(index, cls) {\n\t\tvar re = mask.replace(/\\*/g, '\\\\S+');\n\t\treturn (cls.match(new RegExp('\\\\b' + re + '', 'g')) || []).join(' ');\n\t});\n};\n\n\n\n\n$.ajaxSetup(\n{\n  headers:\n  {\n    'X-CSRF-Token': Laravel.csrfToken\n  }\n});\n\n\nfunction log(data){\n\treturn console.log(data);\n}\n//# sourceMappingURL=app.js.map\n"]}